<!DOCTYPE html>
<html lang="fa" dir="rtl" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#ffffff" id="meta-theme-color">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† | WebLegend Store</title>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { 
                        brand: { 
                            primary: 'var(--brand-color)', 
                            glow: 'var(--brand-glow)',
                            dark: '#0f0f0f',
                            light: '#ffffff',
                            surface: '#f8f9fa',
                            darkSurface: '#1a1a1a'
                        } 
                    },
                    fontFamily: { sans: ['Vazirmatn', 'sans-serif'] },
                    animation: {
                        'enter': 'enter 0.6s cubic-bezier(0.2, 0.8, 0.2, 1)',
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-glow': 'pulseGlow 3s infinite',
                        'shimmer': 'shimmer 1.5s infinite linear',
                        'slide-up-modal': 'slideUpModal 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                    },
                    keyframes: {
                        enter: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 0 0 var(--brand-glow)' }, '70%': { boxShadow: '0 0 0 10px transparent' } },
                        shimmer: { '0%': { backgroundPosition: '-1000px 0' }, '100%': { backgroundPosition: '1000px 0' } },
                        slideUpModal: { '0%': { transform: 'translateY(100%)' }, '100%': { transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --brand-color: #D4AF37; 
            --brand-glow: rgba(212, 175, 55, 0.3);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body { 
            background-color: #f9fafb; /* Light mode bg */
            color: #1f2937; 
            -webkit-tap-highlight-color: transparent; 
            overflow-x: hidden; 
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .dark body {
            background-color: #050505; /* Dark mode bg */
            color: #f3f4f6;
        }

        /* --- Compact Hero Header --- */
        .hero-header {
            position: relative;
            background: #ffffff; /* Default Light */
            padding-top: 2rem;   
            padding-bottom: 3rem; 
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            overflow: hidden;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .dark .hero-header {
            background: #0f0f0f;
            box-shadow: 0 20px 50px -20px rgba(0,0,0,0.5);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .hero-pattern {
            position: absolute; inset: 0; opacity: 0.05;
            background-image: radial-gradient(#000 1px, transparent 1px);
            background-size: 20px 20px;
            mask-image: linear-gradient(to bottom, black, transparent);
        }
        .dark .hero-pattern {
            opacity: 0.2;
            background-image: radial-gradient(var(--brand-color) 1px, transparent 1px);
        }
        
        .hero-glow {
            position: absolute; top: -50%; left: 50%; transform: translateX(-50%);
            width: 120%; height: 120%;
            background: radial-gradient(circle, var(--brand-glow) 0%, transparent 70%);
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .dark .hero-glow { opacity: 0.4; }

        /* --- Avatar Story Ring --- */
        .story-ring {
            padding: 3px;
            background: transparent;
            border: 2px solid var(--brand-color);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--brand-glow);
        }

        /* --- Sticky Smart Bar --- */
        .smart-bar {
            position: sticky; top: 10px; z-index: 40;
            margin: 0 16px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 16px;
            padding: 8px 8px;
            display: flex; flex-direction: column; gap: 8px;
            box-shadow: 0 4px 20px -5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        .dark .smart-bar {
            background: rgba(30, 30, 30, 0.8);
            border-color: rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.3);
        }
        .smart-bar.expanded { margin: 0; top: 0; border-radius: 0; padding: 12px 16px; }

        /* --- Product Card 3.0 (Enhanced) --- */
        .product-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            display: flex; flex-direction: column;
            border: 1px solid #f3f4f6;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }
        .dark .product-card {
            background: #151515;
            border-color: rgba(255,255,255,0.05);
        }
        .product-card:active { transform: scale(0.98); }
        
        .card-image-wrapper {
            position: relative; width: 100%; aspect-ratio: 1/1;
            background: #f9fafb; overflow: hidden;
        }
        .dark .card-image-wrapper { background: #1a1a1a; }
        
        .card-image {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.5s ease;
        }
        .product-card:hover .card-image { transform: scale(1.05); }

        .btn-buy {
            background: var(--brand-color);
            color: black;
            font-weight: 800;
            text-align: center;
            padding: 10px;
            border-radius: 12px;
            width: 100%;
            transition: all 0.2s;
            font-size: 12px;
            box-shadow: 0 4px 15px -3px var(--brand-glow);
        }
        .btn-buy:active { transform: scale(0.95); opacity: 0.9; }
        
        .btn-disabled {
            background: #e5e7eb; color: #9ca3af; cursor: not-allowed; box-shadow: none;
        }
        .dark .btn-disabled { background: #333; color: #555; }

        .badge-discount {
            position: absolute; top: 10px; left: 10px; z-index: 10;
            background: #ef4444; color: white;
            font-weight: 900; font-size: 10px;
            padding: 4px 8px; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.4);
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .badge-stock {
            position: absolute; top: 10px; right: 10px; z-index: 10;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            color: white; font-weight: 700; font-size: 9px;
            padding: 3px 8px; border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .badge-stock.warning { background: rgba(234, 179, 8, 0.9); color: black; border-color: transparent; }

        /* --- Skeleton Loading --- */
        .skeleton {
            background: #f6f7f8;
            background-image: linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%);
            background-repeat: no-repeat;
            background-size: 1000px 100%; 
            animation: shimmer 1.5s infinite linear;
        }
        .dark .skeleton {
            background: #1a1a1a;
            background-image: linear-gradient(to right, #1a1a1a 0%, #222 20%, #1a1a1a 40%, #1a1a1a 100%);
        }

        /* --- Bottom Nav --- */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 12px 24px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 90;
            box-shadow: 0 10px 40px -5px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .dark .bottom-nav {
            background: rgba(20, 20, 20, 0.9);
            box-shadow: 0 10px 40px -5px rgba(0,0,0,0.5);
            border-color: rgba(255,255,255,0.1);
        }
        .nav-item {
            color: #9ca3af; font-size: 20px;
            transition: all 0.3s; position: relative;
            display: flex; flex-direction: column; align-items: center;
        }
        .nav-item.active { color: var(--brand-color); transform: translateY(-3px); }

        /* --- AI Assistant Modal --- */
        .ai-modal {
            position: fixed; inset: 0; z-index: 200;
            background: #fff;
            display: flex; flex-direction: column;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
        }
        .dark .ai-modal { background: #111; }
        .ai-modal.open { transform: translateY(0); }
        
        .ai-header {
            padding: 16px; border-bottom: 1px solid #f3f4f6;
            display: flex; justify-content: space-between; align-items: center;
            background: white;
        }
        .dark .ai-header { background: #151515; border-color: rgba(255,255,255,0.05); }
        
        .ai-body {
            flex: 1; overflow-y: auto; padding: 20px;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex; flex-direction: column; justify-content: flex-end;
        }
        .dark .ai-body {
            background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
        }

        .ai-message {
            background: #f3f4f6; padding: 16px; border-radius: 20px; border-bottom-right-radius: 4px;
            max-width: 85%; margin-bottom: 20px; font-size: 13px; line-height: 1.6;
            color: #374151; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .dark .ai-message { background: #222; color: #e5e7eb; }

        .ai-suggestions {
            display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px;
            scrollbar-width: none;
        }
        .ai-chip {
            white-space: nowrap; padding: 10px 16px; border-radius: 16px;
            background: white; border: 1px solid #e5e7eb; color: #4b5563;
            font-size: 11px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); transition: all 0.2s;
        }
        .dark .ai-chip { background: #222; border-color: rgba(255,255,255,0.1); color: #ccc; }
        .ai-chip:active { transform: scale(0.95); }
        .ai-chip i { margin-left: 6px; color: var(--brand-color); }

        .ai-input-area {
            padding: 16px; border-top: 1px solid #f3f4f6; background: white;
            display: flex; gap: 10px; align-items: center; padding-bottom: max(16px, env(safe-area-inset-bottom));
        }
        .dark .ai-input-area { background: #151515; border-color: rgba(255,255,255,0.05); }

        /* --- Search Overlay --- */
        .search-overlay {
            position: fixed; inset: 0; background: rgba(255,255,255,0.98); z-index: 150;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column; padding: 20px;
        }
        .dark .search-overlay { background: rgba(10,10,10,0.98); }
        .search-overlay.open { transform: translateY(0); }

        .hide-scroll::-webkit-scrollbar { display: none; }
        
        /* --- Filters & Tags --- */
        .filter-chip {
            white-space: nowrap; padding: 6px 14px; border-radius: 12px;
            font-size: 10px; font-weight: 700; cursor: pointer; transition: all 0.2s;
            border: 1px solid transparent;
        }
        .filter-chip-active { background: #111; color: white; box-shadow: 0 4px 10px -2px rgba(0,0,0,0.3); }
        .filter-chip-inactive { background: white; border-color: #eee; color: #666; }
        .dark .filter-chip-active { background: white; color: black; }
        .dark .filter-chip-inactive { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.1); color: #999; }

    </style>
</head>
<body class="pb-32">

    <div id="ai-modal" class="ai-modal">
        <div class="ai-header">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-brand-primary to-yellow-300 flex items-center justify-center text-black shadow-lg">
                    <i class="fas fa-robot text-lg"></i>
                </div>
                <div>
                    <h3 class="font-black text-sm text-gray-900 dark:text-white">Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø±ÛŒØ¯</h3>
                    <p class="text-[10px] text-green-500 font-bold flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Ø¢Ù†Ù„Ø§ÛŒÙ† Ùˆ Ù‡ÙˆØ´Ù…Ù†Ø¯</p>
                </div>
            </div>
            <button onclick="toggleAI()" class="w-8 h-8 rounded-full bg-gray-50 dark:bg-white/5 flex items-center justify-center text-gray-400 hover:text-red-500 transition"><i class="fas fa-chevron-down"></i></button>
        </div>
        
        <div class="ai-body">
            <div class="ai-message">
                Ø³Ù„Ø§Ù…! ğŸ‘‹ <br>
                Ù…Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§ÛŒÙ† ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù‡Ø³ØªÙ…. <br>
                Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¨Ù‡Øª Ú©Ù…Ú© Ú©Ù†Ù… Ø®Ø±ÛŒØ¯ Ù„Ø°Øªâ€ŒØ¨Ø®Ø´â€ŒØªØ±ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØŸ
            </div>
            
            <div class="ai-suggestions">
                <button class="ai-chip" onclick="alert('Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯!')"><i class="fas fa-gift"></i> Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù‡Ø¯ÛŒÙ‡</button>
                <button class="ai-chip" onclick="alert('Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯!')"><i class="fas fa-tag"></i> Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±ÛŒÙ†â€ŒÙ‡Ø§</button>
                <button class="ai-chip" onclick="alert('Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯!')"><i class="fas fa-star"></i> Ù…Ø­Ø¨ÙˆØ¨â€ŒØªØ±ÛŒÙ†â€ŒÙ‡Ø§</button>
            </div>
        </div>

        <div class="ai-input-area">
            <input type="text" placeholder="Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯..." class="flex-1 bg-gray-100 dark:bg-white/10 dark:text-white border-none rounded-xl px-4 py-3 text-sm font-medium outline-none focus:ring-2 focus:ring-brand-primary/50 transition">
            <button class="w-10 h-10 rounded-xl bg-brand-primary text-black flex items-center justify-center shadow-lg hover:scale-105 transition"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="search-overlay" class="search-overlay">
        <div class="flex justify-between items-center mb-8">
            <h3 class="font-black text-2xl dark:text-white">Ø¬Ø³ØªØ¬Ùˆ</h3>
            <button onclick="toggleSearch()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-white/10 flex items-center justify-center hover:bg-red-50 dark:hover:bg-red-900/20 text-gray-500 dark:text-gray-300 hover:text-red-500 transition">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="relative mb-6">
            <i class="fas fa-search absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
            <input type="text" id="overlay-search-input" placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." class="w-full bg-gray-50 dark:bg-white/5 border-2 border-transparent focus:border-brand-primary rounded-2xl py-4 pr-12 pl-4 font-bold text-lg outline-none transition-all dark:text-white">
        </div>
        <div class="flex-1 overflow-y-auto" id="search-results">
            <div class="text-center text-gray-400 mt-10">
                <i class="fas fa-search text-4xl mb-4 opacity-20"></i>
                <p class="text-sm">Ú†ÛŒØ²ÛŒ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯...</p>
            </div>
        </div>
    </div>

    <header class="hero-header" id="main-header">
        <div class="hero-pattern"></div>
        <div class="hero-glow"></div>
        
        <div class="absolute top-4 left-4 z-20">
            <button id="themeToggleBtn" class="w-9 h-9 rounded-full bg-gray-100 dark:bg-white/10 flex items-center justify-center text-gray-600 dark:text-yellow-400 shadow-sm transition hover:scale-110">
                <i class="fas fa-moon dark:hidden"></i>
                <i class="fas fa-sun hidden dark:block"></i>
            </button>
        </div>

        <div class="relative z-10 px-6 text-center flex flex-col items-center">
            <div class="relative mb-3 group cursor-pointer" onclick="shareStore()">
                <div class="story-ring">
                    <div class="w-20 h-20 rounded-full border-4 border-white dark:border-[#111] overflow-hidden bg-gray-100 dark:bg-gray-800">
                        <img id="store-logo" src="img/logo01.png" class="w-full h-full object-cover transition duration-500 group-hover:scale-110" onerror="this.style.display='none'">
                    </div>
                </div>
                <div class="absolute -bottom-2 bg-brand-primary text-black text-[8px] font-black px-2 py-0.5 rounded-full shadow-lg border-2 border-white dark:border-[#111]">
                    VERIFIED
                </div>
            </div>

            <h1 class="text-xl font-black mb-1 tracking-tight text-gray-900 dark:text-white drop-shadow-sm" id="store-name">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø´Ù…Ø§</h1>
            <p class="text-gray-500 dark:text-gray-400 text-[10px] font-medium max-w-[80%] leading-relaxed line-clamp-1" id="store-bio">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ø¨Ù‡ Ø¯Ù†ÛŒØ§ÛŒ Ú©ÛŒÙÛŒØª Ùˆ Ø²ÛŒØ¨Ø§ÛŒÛŒ.</p>
            
            <div class="mt-4 flex gap-2">
                <a href="#" id="link-instagram" target="_blank" class="hidden bg-gray-100 dark:bg-white/10 text-gray-700 dark:text-white px-4 py-2 rounded-xl text-[10px] font-bold hover:bg-gray-200 dark:hover:bg-white/20 transition flex items-center gap-1.5">
                    <i class="fab fa-instagram text-sm"></i> Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…
                </a>
                <button onclick="shareStore()" class="bg-brand-primary text-black px-4 py-2 rounded-xl text-[10px] font-black shadow-lg hover:scale-105 transition flex items-center gap-1.5">
                    <i class="fas fa-share-nodes text-sm"></i> Ø§Ø´ØªØ±Ø§Ú©
                </button>
            </div>
        </div>
    </header>

    <div id="smart-bar" class="smart-bar">
        <div class="flex items-center gap-2 overflow-x-auto hide-scroll w-full pb-1">
            <button onclick="applyFilter('all')" class="filter-chip filter-chip-active" id="btn-filter-all">Ù‡Ù…Ù‡</button>
            <button onclick="applyFilter('popular')" class="filter-chip filter-chip-inactive" id="btn-filter-popular"><i class="fas fa-fire text-orange-500"></i> Ù…Ø­Ø¨ÙˆØ¨â€ŒØªØ±ÛŒÙ†</button>
            <button onclick="applyFilter('cheapest')" class="filter-chip filter-chip-inactive" id="btn-filter-cheapest"><i class="fas fa-arrow-down text-green-500"></i> Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±ÛŒÙ†</button>
            <button onclick="applyFilter('expensive')" class="filter-chip filter-chip-inactive" id="btn-filter-expensive"><i class="fas fa-arrow-up text-red-500"></i> Ú¯Ø±Ø§Ù†â€ŒØªØ±ÛŒÙ†</button>
        </div>
        
        <div class="w-full h-[1px] bg-gray-100 dark:bg-white/5 my-1"></div>

        <div class="flex items-center justify-between w-full">
            <div class="flex items-center gap-2 overflow-x-auto hide-scroll flex-1 pr-1" id="category-pills">
                <div class="skeleton h-6 w-16 rounded-xl"></div>
                <div class="skeleton h-6 w-20 rounded-xl"></div>
                <div class="skeleton h-6 w-14 rounded-xl"></div>
            </div>
            <div class="w-[1px] h-6 bg-gray-200 dark:bg-white/10 mx-3"></div>
            <button onclick="toggleSearch()" class="text-gray-500 dark:text-gray-400 hover:text-brand-primary transition">
                <i class="fas fa-search text-lg"></i>
            </button>
        </div>
    </div>

    <main class="px-4 mt-6 max-w-5xl mx-auto">
        <div class="flex justify-between items-end mb-6 px-2">
            <h2 class="text-base font-black text-gray-800 dark:text-white flex items-center gap-2">
                <span class="w-1.5 h-1.5 rounded-full bg-brand-primary animate-pulse"></span>
                ÙˆÛŒØªØ±ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª
            </h2>
            <span class="text-[9px] bg-white dark:bg-white/5 border border-gray-100 dark:border-white/10 px-2 py-1 rounded-lg text-gray-500 dark:text-gray-400 font-bold" id="product-count">...</span>
        </div>

        <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pb-20">
            <div class="product-card h-64">
                <div class="skeleton w-full aspect-square"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded-lg"></div>
                    <div class="skeleton h-3 w-1/2 rounded-lg"></div>
                    <div class="skeleton h-8 w-full rounded-xl mt-4"></div>
                </div>
            </div>
            <div class="product-card h-64">
                <div class="skeleton w-full aspect-square"></div>
                <div class="p-3 space-y-2">
                    <div class="skeleton h-4 w-3/4 rounded-lg"></div>
                    <div class="skeleton h-3 w-1/2 rounded-lg"></div>
                    <div class="skeleton h-8 w-full rounded-xl mt-4"></div>
                </div>
            </div>
        </div>

        <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20">
            <div class="w-20 h-20 bg-gray-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-6 text-gray-300 dark:text-white/20 text-3xl animate-float">
                <i class="fas fa-box-open"></i>
            </div>
            <h3 class="font-black text-gray-400 dark:text-gray-500 text-sm">Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!</h3>
            <button onclick="resetFilters()" class="mt-4 text-brand-primary text-xs font-bold border-b border-dashed border-brand-primary">Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª</button>
        </div>
    </main>

    <nav class="bottom-nav">
        <a href="#" onclick="window.scrollTo({top:0, behavior:'smooth'}); return false;" class="nav-item active">
            <i class="fas fa-home"></i>
        </a>
        <button onclick="toggleSearch()" class="nav-item">
            <i class="fas fa-search"></i>
        </button>
        <button onclick="toggleAI()" class="nav-item animate-pulse-glow" style="color: var(--brand-color);">
            <i class="fas fa-brain text-2xl"></i>
        </button>
    </nav>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

        // 1. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØªØµØ§Ù„
        const supabaseUrl = 'https://bclbzdvupfiqihcdjltu.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJjbGJ6ZHZ1cGZpcWloY2RqbHR1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1NjA5NTcsImV4cCI6MjA4MjEzNjk1N30.fiCvS54TEbVZPm_chLcHEo8MAr1AHhP5CKNGbxr02JY'
        const supabase = createClient(supabaseUrl, supabaseKey)

        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª
        let allProducts = [];
        let sellerProfile = null;
        let currentCategory = 'all';
        let searchQuery = '';

        // --- UTILS ---
        const formatPrice = (n) => new Intl.NumberFormat('fa-IR').format(n);
        
        // --- THEME & INIT ---
        function initTheme() {
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯ Ø³ÛŒØ³ØªÙ… ÛŒØ§ Ù„ÙˆÚ©Ø§Ù„ Ø§Ø³ØªÙˆØ±ÛŒØ¬
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        window.toggleTheme = () => {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }

        async function init() {
            initTheme();
            
            // 1. Ø¯Ø±ÛŒØ§ÙØª ID ÙØ±ÙˆØ´Ù†Ø¯Ù‡ Ø§Ø² URL
            const urlParams = new URLSearchParams(window.location.search);
            const sellerId = urlParams.get('id');

            if (!sellerId) {
                document.body.innerHTML = `
                    <div class="flex flex-col items-center justify-center min-h-screen bg-gray-50 dark:bg-[#0a0a0a] text-center p-4">
                        <i class="fas fa-store-slash text-6xl text-gray-300 mb-4"></i>
                        <h1 class="text-xl font-bold text-gray-700 dark:text-gray-200">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h1>
                        <p class="text-gray-500 mt-2 text-sm">Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù„ÛŒÙ†Ú© ØµØ­ÛŒØ­ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
                    </div>`;
                return;
            }

            // 2. Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ (Ù†Ø§Ù…ØŒ Ù„ÙˆÚ¯ÙˆØŒ Ø±Ù†Ú¯ Ø¨Ø±Ù†Ø¯)
            await loadSellerProfile(sellerId);

            // 3. Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØµÙˆÙ„Ø§Øª
            await loadProducts(sellerId);
            
            // 4. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§
            setupFilters();
        }

        async function loadSellerProfile(sellerId) {
            try {
                const { data, error } = await supabase
                    .from('store_profiles')
                    .select('*')
                    .eq('user_id', sellerId)
                    .single();

                if (error) throw error;
                sellerProfile = data;

                // Ø§Ø¹Ù…Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±ÙˆÛŒ ØµÙØ­Ù‡
                if (data) {
                    // Ù†Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡
                    document.title = data.shop_name || 'ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†';
                    const titleEls = document.querySelectorAll('.store-name-target');
                    titleEls.forEach(el => el.innerText = data.shop_name || 'ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…Ù†');

                    // Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ
                    const bioEl = document.getElementById('store-bio');
                    if(bioEl) bioEl.innerText = data.bio || 'Ø¨Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯';

                    // Ù„ÙˆÚ¯Ùˆ
                    if (data.avatar_url) {
                        const logoEls = document.querySelectorAll('.store-logo-target');
                        logoEls.forEach(img => img.src = data.avatar_url);
                    }

                    // Ø±Ù†Ú¯ Ø¨Ø±Ù†Ø¯ (Ø§Ø¹Ù…Ø§Ù„ Ø±ÙˆÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ CSS)
                    if (data.brand_color) {
                        document.documentElement.style.setProperty('--brand-color', data.brand_color);
                        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªÙ‚ Ø´Ø¯Ù‡ (Ø³Ø§ÛŒÙ‡ Ùˆ ...)
                        document.documentElement.style.setProperty('--brand-glow', data.brand_color + '40'); // 25% opacity
                    }
                    
                    // Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ
                    if(data.instagram_id) {
                        const instaBtn = document.getElementById('btn-instagram');
                        if(instaBtn) {
                            instaBtn.href = `https://instagram.com/${data.instagram_id}`;
                            instaBtn.classList.remove('hidden');
                        }
                    }
                }

            } catch (err) {
                console.error('Error loading profile:', err);
            }
        }

        async function loadProducts(sellerId) {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '<div class="col-span-full text-center py-20 text-gray-400 animate-pulse"><i class="fas fa-circle-notch fa-spin text-3xl mb-3"></i><p>Ø¯Ø± Ø­Ø§Ù„ Ú†ÛŒØ¯Ù…Ø§Ù† ÙˆÛŒØªØ±ÛŒÙ†...</p></div>';

            try {
                // ÙÙ‚Ø· Ù…Ø­ØµÙˆÙ„Ø§Øª ÙØ¹Ø§Ù„ Ø§ÛŒÙ† ÙØ±ÙˆØ´Ù†Ø¯Ù‡
                const { data, error } = await supabase
                    .from('store_products')
                    .select('*')
                    .eq('seller_id', sellerId)
                    .eq('is_active', true)
                    .order('created_at', { ascending: false });

                if (error) throw error;
                allProducts = data || [];

                renderCategories(); // Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÙˆØ¬ÙˆØ¯
                renderProducts();   // Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª

            } catch (err) {
                console.error(err);
                grid.innerHTML = `
                    <div class="col-span-full text-center py-10 text-red-400 bg-red-50 dark:bg-red-900/10 rounded-2xl border border-red-100 dark:border-red-900/30">
                        <i class="fas fa-exclamation-triangle mb-2 text-2xl"></i>
                        <p>Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†Ø´Ø¯.</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-red-500 text-white rounded-lg text-xs font-bold hover:bg-red-600 transition">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>
                    </div>`;
            }
        }

        function renderCategories() {
            const container = document.getElementById('category-pills');
            if (!container) return;

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÛŒÚ©ØªØ§ Ø§Ø² Ù…Ø­ØµÙˆÙ„Ø§Øª
            const categories = new Set(['all']);
            allProducts.forEach(p => {
                if(p.category) categories.add(p.category);
            });

            container.innerHTML = '';
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = `filter-chip whitespace-nowrap px-4 py-2 rounded-full text-xs font-bold transition-all border ${cat === 'all' ? 'filter-chip-active bg-brand-primary text-white border-brand-primary' : 'filter-chip-inactive bg-white dark:bg-white/5 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-white/10 hover:border-brand-primary'}`;
                btn.innerText = cat === 'all' ? 'Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª' : cat;
                btn.onclick = () => setCategory(cat, btn);
                container.appendChild(btn);
            });
        }

        window.setCategory = (cat, btn) => {
            currentCategory = cat;
            
            // Ø¢Ù¾Ø¯ÛŒØª UI Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.querySelectorAll('.filter-chip').forEach(el => {
                el.classList.remove('filter-chip-active', 'bg-brand-primary', 'text-white', 'border-brand-primary');
                el.classList.add('filter-chip-inactive', 'bg-white', 'dark:bg-white/5', 'text-gray-600', 'dark:text-gray-300', 'border-gray-200', 'dark:border-white/10');
            });
            btn.classList.remove('filter-chip-inactive', 'bg-white', 'dark:bg-white/5', 'text-gray-600', 'dark:text-gray-300', 'border-gray-200', 'dark:border-white/10');
            btn.classList.add('filter-chip-active', 'bg-brand-primary', 'text-white', 'border-brand-primary');

            renderProducts();
        }

        function setupFilters() {
            const searchInput = document.getElementById('search-input');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    searchQuery = e.target.value.toLowerCase();
                    renderProducts();
                });
            }
        }

        function renderProducts() {
            const grid = document.getElementById('products-grid');
            
            // ÙÛŒÙ„ØªØ± ØªØ±Ú©ÛŒØ¨ÛŒ (Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ + Ø¬Ø³ØªØ¬Ùˆ)
            const filtered = allProducts.filter(p => {
                const matchCat = currentCategory === 'all' || p.category === currentCategory;
                const matchSearch = !searchQuery || p.title.toLowerCase().includes(searchQuery);
                return matchCat && matchSearch;
            });

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full flex flex-col items-center justify-center py-16 text-gray-400">
                        <i class="fas fa-search text-4xl mb-3 opacity-20"></i>
                        <p class="text-sm">Ù…Ø­ØµÙˆÙ„ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù…Ø´Ø®ØµØ§Øª Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.</p>
                        <button onclick="window.resetFilters()" class="mt-2 text-brand-primary text-xs hover:underline">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡</button>
                    </div>`;
                return;
            }

            grid.innerHTML = '';
            filtered.forEach(p => {
                // Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ± (Ú†ÙˆÙ† Ø¢Ø±Ø§ÛŒÙ‡ JSON Ø§Ø³Øª)
                let imgUrl = 'img/placeholder.png'; // ØªØµÙˆÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
                if (p.image_url) {
                    try {
                        const parsed = JSON.parse(p.image_url);
                        if (Array.isArray(parsed) && parsed.length > 0) imgUrl = parsed[0];
                        else if (typeof parsed === 'string') imgUrl = parsed;
                    } catch (e) {
                        // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙØ±Ù…Øª Ù‚Ø¯ÛŒÙ…ÛŒ (Ø§Ú¯Ø± ÙÙ‚Ø· Ø±Ø´ØªÙ‡ Ø¨ÙˆØ¯)
                        if(typeof p.image_url === 'string' && p.image_url.startsWith('http')) imgUrl = p.image_url;
                    }
                }

                // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‚ÛŒÙ…Øª
                const priceEl = p.discount_info && p.discount_info.active 
                    ? `<div class="flex flex-col items-end">
                         <span class="text-[10px] text-gray-400 line-through decoration-red-500">${formatPrice(p.price)}</span>
                         <span class="text-sm font-black text-brand-primary">${formatPrice(p.price * (100 - p.discount_info.percent) / 100)} <span class="text-[9px] font-normal text-gray-500">ØªÙˆÙ…Ø§Ù†</span></span>
                       </div>`
                    : `<span class="text-sm font-black text-brand-primary">${formatPrice(p.price)} <span class="text-[9px] font-normal text-gray-500">ØªÙˆÙ…Ø§Ù†</span></span>`;

                const badgeEl = p.type === 'digital' 
                    ? `<span class="absolute top-2 right-2 bg-black/60 backdrop-blur text-white text-[9px] px-2 py-1 rounded-lg"><i class="fas fa-cloud-download-alt text-brand-primary"></i> Ø¯Ø§Ù†Ù„ÙˆØ¯ÛŒ</span>` 
                    : ``;

                const card = document.createElement('a');
                card.href = `sale.html?id=${p.id}`; // Ù„ÛŒÙ†Ú© Ø¨Ù‡ ØµÙØ­Ù‡ Ø®Ø±ÛŒØ¯ Ù…Ø­ØµÙˆÙ„
                card.className = "group bg-white dark:bg-[#151515] rounded-2xl overflow-hidden border border-gray-100 dark:border-white/5 hover:border-brand-primary/50 transition-all hover:shadow-lg hover:shadow-brand-primary/10 relative block";
                
                card.innerHTML = `
                    <div class="relative w-full aspect-square bg-gray-50 dark:bg-white/5 overflow-hidden">
                        <img src="${imgUrl}" alt="${p.title}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                        ${badgeEl}
                        ${p.stock_quantity === 0 && p.type === 'physical' ? '<div class="absolute inset-0 bg-black/70 flex items-center justify-center text-white text-xs font-bold backdrop-blur-[1px]">Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</div>' : ''}
                    </div>
                    
                    <div class="p-4">
                        <h3 class="font-bold text-gray-800 dark:text-gray-100 text-sm mb-1 line-clamp-1 group-hover:text-brand-primary transition-colors">${p.title}</h3>
                        ${p.short_description ? `<p class="text-[10px] text-gray-500 line-clamp-1 mb-3">${p.short_description}</p>` : '<div class="h-4 mb-3"></div>'}
                        
                        <div class="flex items-center justify-between border-t border-gray-100 dark:border-white/5 pt-3">
                            <span class="text-[10px] text-gray-400 bg-gray-100 dark:bg-white/5 px-2 py-1 rounded-md">${p.category || 'Ø¹Ù…ÙˆÙ…ÛŒ'}</span>
                            ${priceEl}
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        window.resetFilters = () => {
             currentCategory = 'all';
             searchQuery = '';
             const input = document.getElementById('search-input');
             if(input) input.value = '';
             
             // Ø±ÛŒØ³Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©ØªÚ¯ÙˆØ±ÛŒ
             document.querySelectorAll('.filter-chip').forEach(el => {
                if(el.innerText === 'Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª') {
                    el.classList.add('filter-chip-active', 'bg-brand-primary', 'text-white');
                    el.classList.remove('filter-chip-inactive', 'bg-white', 'text-gray-600');
                } else {
                    el.classList.remove('filter-chip-active', 'bg-brand-primary', 'text-white');
                    el.classList.add('filter-chip-inactive');
                }
             });
             
             renderProducts();
        };

        window.shareStore = () => {
            if (navigator.share) {
                navigator.share({ title: document.title, url: window.location.href });
            } else {
                navigator.clipboard.writeText(window.location.href);
                Toastify({ 
                    text: "Ù„ÛŒÙ†Ú© ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ú©Ù¾ÛŒ Ø´Ø¯", 
                    duration: 3000, 
                    style: { background: getComputedStyle(document.documentElement).getPropertyValue('--brand-color'), borderRadius: "10px", fontSize: "12px" } 
                }).showToast();
            }
        };

        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        init();
    </script>
</body>
</html>